!function(V){"use strict";V(document).ready(function(){if("undefined"!=typeof ere_property_vars){var e={};e.isMobile=/(Android|BlackBerry|iPhone|iPad|Palm|Symbian|Opera Mini|IEMobile|webOS)/.test(navigator.userAgent),e.isAndroid=/(Android)/.test(navigator.userAgent),e.isiOS=/(iPhone|iPod|iPad)/.test(navigator.userAgent),e.isiPhone=/(iPhone|iPod)/.test(navigator.userAgent),e.isiPad=/(iPad|iPod)/.test(navigator.userAgent);var o,t,i=ere_property_vars.ajax_url,a=".property-manager-form",x=ere_property_vars.ere_metabox_prefix,r=ere_property_vars.googlemap_zoom_level,n=ere_property_vars.google_map_style,l=ere_property_vars.googlemap_marker_icon,s=ere_property_vars.googlemap_default_country,p=ere_property_vars.googlemap_coordinate_default,d=ere_property_vars.upload_nonce,c=ere_property_vars.file_type_title,_=ere_property_vars.max_property_images,f=ere_property_vars.image_max_file_size,m=ere_property_vars.max_property_attachments,u=ere_property_vars.attachment_max_file_size,v=ere_property_vars.attachment_file_type,g=ere_property_vars.floor_name_text,h=ere_property_vars.floor_size_text,y=ere_property_vars.floor_size_postfix_text,b=ere_property_vars.floor_bedrooms_text,j=ere_property_vars.floor_bathrooms_text,w=ere_property_vars.floor_price_text,z=ere_property_vars.floor_price_postfix_text,k=ere_property_vars.floor_image_text,E=ere_property_vars.floor_description_text,P=ere_property_vars.floor_upload_text,A=V("#geocomplete");!function(){V('input[name="property_form"]').val();var e=[];""!==n&&(e=JSON.parse(n)),A.geocomplete({map:".map_canvas",details:"form",country:s,geocodeAfterResult:!0,types:["geocode","establishment"],mapOptions:{zoom:parseInt(r),styles:e},markerOptions:{draggable:!0,icon:l},location:""!==A.val()?A.val():p}).one("geocode:result",function(e,r){o=A.geocomplete("map"),google.maps.event.addListenerOnce(o,"idle",function(){google.maps.event.trigger(o,"resize"),t=r.geometry.location,o.setCenter(r.geometry.location)})}),A.bind("geocode:dragged",function(e,r){V("input[name=lat]").val(r.lat()),V("input[name=lng]").val(r.lng()),V("#reset").show()}),A.on("focus",function(){google.maps.event.trigger(o,"resize")}),V("#reset").on("click",function(e){return e.preventDefault(),A.geocomplete("resetMarker"),V("#reset").hide(),!1}),V("#find").on("click",function(e){e.preventDefault(),o=A.geocomplete("map");var r=A.geocomplete("marker");t=new google.maps.LatLng(V("#latitude").val(),V("#longitude").val()),o.setCenter(t),r.setPosition(t)}),V(window).load(function(){A.trigger("geocode")})}(),V('input[name="agent_display_option"]',a).on("change",function(){V('select[name="property_agent"]').hide(),"other_info"==V(this).val()?V("#property_other_contact").slideDown("slow"):V("#property_other_contact").slideUp("slow")});var O=function(){V('input[name="property_price_on_call"]').is(":checked")?(V('input[name="property_price_short"]').attr("disabled","disabled"),V('select[name="property_price_unit"]').attr("disabled","disabled"),V('input[name="property_price_prefix"]').attr("disabled","disabled"),V('input[name="property_price_postfix"]').attr("disabled","disabled")):(V('input[name="property_price_short"]').removeAttr("disabled"),V('select[name="property_price_unit"]').removeAttr("disabled"),V('input[name="property_price_prefix"]').removeAttr("disabled"),V('input[name="property_price_postfix"]').removeAttr("disabled"))};O(),V('input[name="property_price_on_call"]',a).on("change",function(){O()});var S=function(){var o=0;V("tr","#ere_additional_details").each(function(){var e=V('input[name*="additional_feature_title"]',V(this)),r=V('input[name*="additional_feature_value"]',V(this));e.attr("name","additional_feature_title["+o+"]"),e.attr("id","additional_feature_title_"+o),r.attr("name","additional_feature_value["+o+"]"),r.attr("id","additional_feature_value_"+o),o++})};V("#ere_additional_details").sortable({revert:100,placeholder:"detail-placeholder",handle:".sort-additional-row",cursor:"move",stop:function(e,r){S()}}),V(".add-additional-feature",a).on("click",function(e){e.preventDefault();var r=V(this).data("increment")+1;V(this).data("increment",r),V(this).attr({"data-increment":r});var o='<tr><td class="action-field"><span class="sort-additional-row"><i class="fa fa-navicon"></i></span></td><td><input class="form-control" type="text" name="additional_feature_title['+r+']" id="additional_feature_title_'+r+'" value=""></td><td><input class="form-control" type="text" name="additional_feature_value['+r+']" id="additional_feature_value_'+r+'" value=""></td><td><span data-remove="'+r+'" class="remove-additional-feature"><i class="fa fa-remove"></i></span></td></tr>';V("#ere_additional_details").append(o),I()});var I=function(){V(".remove-additional-feature",a).on("click",function(e){e.preventDefault();var r=V(this),o=r.closest(".additional-block").find(".add-additional-feature"),t=parseInt(o.data("increment"))-1;r.closest("tr").remove(),o.data("increment",t),o.attr("data-increment",t),S()})};I();var T=function(){var b=0;V("tr","#ere_floors").each(function(){var e=V('label[for*="'+x+'floor_name_"]',V(this)),r=V('input[name*="'+x+'floor_name"]',V(this)),o=V('label[for*="'+x+'floor_price_"]',V(this)),t=V('input[name*="'+x+'floor_price"]',V(this)),a=V('label[for*="'+x+'floor_price_postfix_"]',V(this)),i=V('input[name*="'+x+'floor_price_postfix"]',V(this)),n=V('label[for*="'+x+'floor_size_"]',V(this)),l=V('input[name*="'+x+'floor_size"]',V(this)),s=V('label[for*="'+x+'floor_size_postfix_"]',V(this)),p=V('input[name*="'+x+'floor_size_postfix"]',V(this)),d=V('label[for*="'+x+'floor_bedrooms_"]',V(this)),c=V('input[name*="'+x+'floor_bedrooms"]',V(this)),_=V('label[for*="'+x+'floor_bathrooms_"]',V(this)),f=V('input[name*="'+x+'floor_bedrooms"]',V(this)),m=V('label[for*="'+x+'floor_image_url_"]',V(this)),u=V('input[id*="'+x+'floor_image_url"]',V(this)),v=V('input[id*="'+x+'floor_image_id"]',V(this)),g=V('button[class*="ere_floorsImg"]',V(this)),h=V('label[for*="'+x+'floor_description_"]',V(this)),y=V('input[id*="'+x+'floor_description"]',V(this));e.attr("for",x+"floor_name_"+b),r.attr("name",x+"floors["+b+"]["+x+"floor_name]"),r.attr("id",x+"floor_name_"+b),o.attr("for",x+"floor_price_"+b),t.attr("name",x+"floors["+b+"]["+x+"floor_price]"),t.attr("id",x+"floor_price_"+b),a.attr("for",x+"floor_price_postfix_"+b),i.attr("name",x+"floors["+b+"]["+x+"floor_price_postfix]"),i.attr("id",x+"floor_price_postfix_"+b),n.attr("for",x+"floor_size_"+b),l.attr("name",x+"floors["+b+"]["+x+"floor_size]"),l.attr("id",x+"floor_size_"+b),s.attr("for",x+"floor_size_postfix_"+b),p.attr("name",x+"floors["+b+"]["+x+"floor_size_postfix]"),p.attr("id",x+"floor_size_postfix_"+b),d.attr("for",x+"floor_bedrooms_"+b),c.attr("name",x+"floors["+b+"]["+x+"floor_bedrooms]"),c.attr("id",x+"floor_bedrooms_"+b),_.attr("for",x+"floor_bathrooms_"+b),f.attr("name",x+"floors["+b+"]["+x+"floor_bathrooms]"),f.attr("id",x+"floor_bathrooms_"+b),m.attr("for",x+"floor_image_url_"+b),u.attr("name",x+"floors["+b+"]["+x+"floor_image][url]"),u.attr("id",x+"floor_image_url_"+b),v.attr("name",x+"floors["+b+"]["+x+"floor_image][id]"),v.attr("id",x+"floor_image_id_"+b),g.attr("id",b),h.attr("for",x+"floor_description_"+b),y.attr("name",x+"floors["+b+"]["+x+"floor_description]"),y.attr("id",x+"floor_description_"+b),b++})};V("#ere_floors").sortable({revert:100,placeholder:"detail-placeholder",handle:".sort-floors-row",cursor:"move",stop:function(e,r){T()}});var M={},C=function(a){M["id"+a]=new plupload.Uploader({browse_button:"ere-floor-"+a,file_data_name:"property_upload_file",container:"ere-floor-plupload-container-"+a,url:i+"?action=ere_property_img_upload_ajax&nonce="+d,filters:{mime_types:[{title:c,extensions:"jpg,jpeg,gif,png"}],max_file_size:f,prevent_duplicates:!0}}),M["id"+a].init(),M["id"+a].bind("FilesAdded",function(e,r){var o=_;if(e.files.length>o)return e.splice(o),void alert("no more than "+o+" file(s)");e.refresh(),M["id"+a].start()}),M["id"+a].bind("Error",function(e,r){document.getElementById("ere-floor-errors-log-"+a).innerHTML+="<br/>Error #"+r.code+": "+r.message}),M["id"+a].bind("FileUploaded",function(e,r,o){var t=V.parseJSON(o.response);t.success&&(V("#ere-floor-plupload-container-"+a).find(".ere_floor_image_url").val(t.full_image),V("#ere-floor-plupload-container-"+a).find(".ere_floor_image_id").val(t.attachment_id))})};C("0");var L=function(){V(".remove-floors-row",a).on("click",function(e){e.preventDefault();var r=V(this),o=r.closest(".add-sort-table").find("#add-floors-row"),t=parseInt(o.data("increment"))-1;r.closest("tr").remove(),o.data("increment",t),o.attr("data-increment",t),T()})};L();q=V('[name="floors_enable"][checked]',".property-floors-control"),G=q.val(),K=q.closest(".property-floors-control").next(".property-floors-data"),1==G?K.slideDown("slow"):0==G&&K.slideUp("slow"),V('input[name="floors_enable"]',".property-floors-control").each(function(){V(this).on("click",function(){1==(G=V(this).val())?(K.slideDown("slow"),e.isiOS&&C("0")):0==G&&K.slideUp("slow")})}),V("#add-floors-row").on("click",function(e){e.preventDefault();var r=V(this).data("increment")+1;V(this).data("increment",r),V(this).attr({"data-increment":r});var o='<tr><td class="row-sort"><span class="sort sort-floors-row"><i class="fa fa-navicon"></i></span></td><td class="sort-middle"><div class="sort-inner-block"><div class="row"><div class="col-sm-12"><div class="form-group"><label for="'+x+"floor_name_"+r+'">'+g+'</label><input name="'+x+"floors["+r+"]["+x+'floor_name]" type="text" id="'+x+"floor_name_"+r+'" class="form-control"></div></div><div class="col-sm-6"><div class="form-group"><label for="'+x+"floor_price_"+r+'">'+w+'</label><input name="'+x+"floors["+r+"]["+x+'floor_price]" type="number" id="'+x+"floor_price_"+r+'" class="form-control"></div></div><div class="col-sm-6"><div class="form-group"><label for="'+x+"floor_price_postfix_"+r+'">'+z+'</label><input name="'+x+"floors["+r+"]["+x+'floor_price_postfix]" type="text" id="'+x+"floor_price_postfix_"+r+'" class="form-control"></div></div><div class="col-sm-6"><div class="form-group"><label for="'+x+"floor_size_"+r+'">'+h+'</label><input name="'+x+"floors["+r+"]["+x+'floor_size]" type="number" id="'+x+"floor_size_"+r+'" class="form-control"></div></div><div class="col-sm-6"><div class="form-group"><label for="'+x+"floor_size_postfix_"+r+'">'+y+'</label><input name="'+x+"floors["+r+"]["+x+'floor_size_postfix]" type="text" id="'+x+"floor_size_postfix_"+r+'" class="form-control"></div></div><div class="col-sm-6"><div class="form-group"><label for="'+x+"floor_bedrooms_"+r+'">'+b+'</label><input name="'+x+"floors["+r+"]["+x+'floor_bedrooms]" type="number" id="'+x+"floor_bedrooms_"+r+'" class="form-control"></div></div><div class="col-sm-6"><div class="form-group"><label for="'+x+"floor_bathrooms_"+r+'">'+j+'</label><input name="'+x+"floors["+r+"]["+x+'floor_bathrooms]" type="number" id="'+x+"floor_bathrooms_"+r+'" class="form-control"></div></div><div class="col-sm-6"><div class="form-group"><label for="'+x+"floor_image_url_"+r+'">'+k+'</label><div id="ere-floor-plupload-container-'+r+'" class="file-upload-block"><input name="'+x+"floors["+r+"]["+x+'floor_image][url]" type="text" id="'+x+"floor_image_url_"+r+'" class="ere_floor_image_url form-control"><input name="'+x+"floors["+r+"]["+x+'floor_image][id]" type="hidden" id="'+x+"floor_image_id_"+r+'" class="ere_floor_image_id"><button type="button" id="ere-floor-'+r+'" style="position: absolute" title="'+P+'" class="ere_floorsImg"><i class="fa fa-file-image-o"></i></button></div><div id="ere-floor-errors-log"></div></div></div><div class="col-sm-6"><div class="form-group"><label for="'+x+"floor_description_"+r+'">'+E+'</label><textarea name="'+x+"floors["+r+"]["+x+'floor_description]" rows="4" id="'+x+"floor_description_"+r+'" class="form-control"></textarea></div></div></div></div></td><td class="row-remove"><span data-remove="'+r+'" class="remove-floors-row remove"><i class="fa fa-remove"></i></span></td></tr>';V("#ere_floors").append(o),L(),C(r)});var U=function(){V(".icon-featured",".ere-property-gallery").on("click",function(){var e=V(this),r=e.data("attachment-id"),o=e.find("i");V(".media-thumb .featured-image-id").remove(),V(".media-thumb .icon-featured i").removeClass("fa-star").addClass("fa-star-o"),e.closest(".media-thumb").append('<input type="hidden" class="featured-image-id" name="featured_image_id" value="'+r+'">'),o.removeClass("fa-star-o").addClass("fa-star")}),V(".icon-delete",".ere-property-gallery").on("click",function(){var e=V(this),r=e.children("i"),o=e.closest(".media-thumb-wrap"),t=e.data("property-id"),a=e.data("attachment-id");r.addClass("fa-spinner fa-spin"),V.ajax({type:"post",url:i,dataType:"json",data:{action:"ere_remove_property_attachment_ajax",property_id:t,attachment_id:a,type:"gallery",removeNonce:d},success:function(e){e.success&&(o.remove(),o.hide()),r.removeClass("fa-spinner fa-spin")},error:function(){r.removeClass("fa-spinner fa-spin")}})})};U();var B=function(){V(".icon-delete",".ere-property-attachments").on("click",function(){var e=V(this),r=e.children("i"),o=e.closest(".media-thumb-wrap"),t=e.data("property-id"),a=e.data("attachment-id");r.addClass("fa-spinner fa-spin"),V.ajax({type:"post",url:i,dataType:"json",data:{action:"ere_remove_property_attachment_ajax",property_id:t,attachment_id:a,type:"attachments",removeNonce:d},success:function(e){e.success&&(o.remove(),o.hide()),r.removeClass("fa-spinner fa-spin")},error:function(){r.removeClass("fa-spinner fa-spin")}})})};B();var H=function(){V("#property_gallery_thumbs_container").sortable();var a=new plupload.Uploader({browse_button:"ere_select_gallery_images",file_data_name:"property_upload_file",container:"ere_gallery_plupload_container",drop_element:"ere_gallery_plupload_container",multi_selection:!0,url:i+"?action=ere_property_img_upload_ajax&nonce="+d,filters:{mime_types:[{title:c,extensions:"jpg,jpeg,gif,png"}],max_file_size:f,prevent_duplicates:!0}});a.init(),a.bind("FilesAdded",function(e,r){var o="",t=_;if(e.files.length>t)return e.splice(t),void alert("no more than "+t+" file(s)");plupload.each(r,function(e){o+='<div id="holder-'+e.id+'" class="col-sm-2 media-thumb-wrap"></div>'}),document.getElementById("property_gallery_thumbs_container").innerHTML+=o,e.refresh(),a.start()}),a.bind("UploadProgress",function(e,r){document.getElementById("holder-"+r.id).innerHTML='<span><i class="fa fa-spinner fa-spin"></i></span>'}),a.bind("Error",function(e,r){document.getElementById("ere_gallery_errors_log").innerHTML+="<br/>Error #"+r.code+": "+r.message}),a.bind("FileUploaded",function(e,r,o){var t=V.parseJSON(o.response);if(t.success){var a='<figure class="media-thumb"><img src="'+t.url+'"/><div class="media-item-actions"><a class="icon icon-delete" data-property-id="0"  data-attachment-id="'+t.attachment_id+'" href="javascript:;" ><i class="fa fa-trash-o"></i></a><a class="icon icon-featured" data-property-id="0"  data-attachment-id="'+t.attachment_id+'" href="javascript:;" ><i class="fa fa-star-o"></i></a><input type="hidden" class="property_image_ids" name="property_image_ids[]" value="'+t.attachment_id+'"/><span style="display: none;" class="icon icon-loader"><i class="fa fa-spinner fa-spin"></i></span></div></figure>';document.getElementById("holder-"+r.id).innerHTML=a,U()}})};H();var D=function(){V("#property_attachments_thumbs_container").sortable();var a=new plupload.Uploader({browse_button:"ere_select_file_attachments",file_data_name:"property_upload_file",container:"ere_attachments_plupload_container",drop_element:"ere_attachments_plupload_container",multi_selection:!0,url:i+"?action=ere_property_attachment_upload_ajax&nonce="+d,filters:{mime_types:[{title:c,extensions:v}],max_file_size:u,prevent_duplicates:!0}});a.init(),a.bind("FilesAdded",function(e,r){var o="",t=m;if(e.files.length>t)return e.splice(t),void alert("no more than "+t+" file(s)");plupload.each(r,function(e){o+='<div id="holder-'+e.id+'" class="col-lg-4 col-md-4 col-sm-6 col-xs-12 media-thumb-wrap"></div>'}),document.getElementById("property_attachments_thumbs_container").innerHTML+=o,e.refresh(),a.start()}),a.bind("UploadProgress",function(e,r){document.getElementById("holder-"+r.id).innerHTML='<span><i class="fa fa-spinner fa-spin"></i></span>'}),a.bind("Error",function(e,r){document.getElementById("ere_attachments_errors_log").innerHTML+="<br/>Error #"+r.code+": "+r.message}),a.bind("FileUploaded",function(e,r,o){var t=V.parseJSON(o.response);if(t.success){var a='<figure class="media-thumb"><img src="'+t.thumb_url+'"/><a href="'+t.url+'">'+t.file_name+'</a><div class="media-item-actions"><a class="icon icon-delete" data-property-id="0"  data-attachment-id="'+t.attachment_id+'" href="javascript:;" ><i class="fa fa-trash-o"></i></a><input type="hidden" class="property_attachment_ids" name="property_attachment_ids[]" value="'+t.attachment_id+'"/><span style="display: none;" class="icon icon-loader"><i class="fa fa-spinner fa-spin"></i></span></div></figure>';document.getElementById("holder-"+r.id).innerHTML=a,B()}})};D();var F=function(){var t=new plupload.Uploader({browse_button:"ere_select_images_360",file_data_name:"property_upload_file",container:"ere_image_360_plupload_container",url:i+"?action=ere_property_img_upload_ajax&nonce="+d,filters:{mime_types:[{title:c,extensions:"jpg,jpeg,gif,png"}],max_file_size:f,prevent_duplicates:!0}});t.init(),t.bind("FilesAdded",function(e,r){var o=_;if(e.files.length>o)return e.splice(o),void alert("no more than "+o+" file(s)");plupload.each(r,function(e){}),e.refresh(),t.start()}),t.bind("Error",function(e,r){document.getElementById("ere_image_360_errors_log").innerHTML+="<br/>Error #"+r.code+": "+r.message}),t.bind("FileUploaded",function(e,r,o){var t=V.parseJSON(o.response);if(t.success){V(".ere_image_360_url").val(t.full_image),V(".ere_image_360_id").val(t.attachment_id);var a='<iframe width="100%" height="200" scrolling="no" allowfullscreen src="'+V("#ere_property_image_360_view").attr("data-plugin-url")+"public/assets/packages/vr-view/index.html?image="+t.full_image+'"></iframe>';V("#ere_property_image_360_view").html(a)}})};F();var N=function(){var o=V(".ere-property-country-ajax",a);if(o.length){var e=o.val();V("#geocomplete").geocomplete("autocomplete").setComponentRestrictions({country:e}),V.ajax({type:"POST",url:i,data:{action:"ere_get_states_by_country_ajax",country:e,type:0,is_slug:"1"},beforeSend:function(){o.parent().children(".ere-loading").remove(),o.parent().append('<span class="ere-loading"><i class="fa fa-spinner fa-spin"></i></span>')},success:function(e){V(".ere-property-state-ajax",a).html(e);var r=V(".ere-property-state-ajax",a).attr("data-selected");void 0!==r&&V(".ere-property-state-ajax",a).val(r),o.parent().children(".ere-loading").remove()},error:function(){o.parent().children(".ere-loading").remove()},complete:function(){o.parent().children(".ere-loading").remove()}})}};N(),V(".ere-property-country-ajax",a).on("change",function(){N()});var J=function(){var o=V(".ere-property-state-ajax",a);if(o.length){var e=o.val();V.ajax({type:"POST",url:i,data:{action:"ere_get_cities_by_state_ajax",state:e,type:0,is_slug:"1"},beforeSend:function(){o.parent().children(".ere-loading").remove(),o.parent().append('<span class="ere-loading"><i class="fa fa-spinner fa-spin"></i></span>')},success:function(e){V(".ere-property-city-ajax",a).html(e);var r=V(".ere-property-city-ajax",a).attr("data-selected");void 0!==r&&V(".ere-property-city-ajax",a).val(r),o.parent().children(".ere-loading").remove()},error:function(){o.parent().children(".ere-loading").remove()},complete:function(){o.parent().children(".ere-loading").remove()}})}};J(),V(".ere-property-state-ajax",a).on("change",function(){J()});var R=function(){var o=V(".ere-property-city-ajax",a);if(o.length){var e=o.val();V.ajax({type:"POST",url:i,data:{action:"ere_get_neighborhoods_by_city_ajax",city:e,type:0,is_slug:"1"},beforeSend:function(){o.parent().children(".ere-loading").remove(),o.parent().append('<span class="ere-loading"><i class="fa fa-spinner fa-spin"></i></span>')},success:function(e){V(".ere-property-neighborhood-ajax",a).html(e);var r=V(".ere-property-neighborhood-ajax",a).attr("data-selected");void 0!==r&&V(".ere-property-neighborhood-ajax",a).val(r),o.parent().children(".ere-loading").remove()},error:function(){o.parent().children(".ere-loading").remove()},complete:function(){o.parent().children(".ere-loading").remove()}})}};R(),V(".ere-property-city-ajax",a).on("change",function(){R()});var Q=V(".ere-property-multi-step");Q.find(".ere-btn-next").on("click",function(){e.isiOS&&(H(),D(),F(),C("0")),"false"===V("#step-location").attr("aria-hidden")&&void 0!==A&&A.trigger("geocode")}),Q.find(".ere-btn-edit").on("click",function(){e.isiOS&&(H(),D(),F(),C("0")),"false"===V("#step-location").attr("aria-hidden")&&void 0!==A&&A.trigger("geocode")}),"1"==ere_property_vars.enable_filter_location&&(V(".ere-property-country-ajax",a).select2(),V(".ere-property-state-ajax",a).select2(),V(".ere-property-city-ajax",a).select2(),V(".ere-property-neighborhood-ajax",a).select2())}var q,G,K})}(jQuery);